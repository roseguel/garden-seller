{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'BuyBeeApp/css/carrito.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
        <link href='https://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet'>
    <title>Carrito</title>
    <script src="{% static 'BuyBeeApp/js/jquery.js' %}"></script>
</head>
<body>
    <div id="nav">
        <a id="salir" href="{% url 'home' %}"><img src="{% static 'BuyBeeApp/assets/images/Exit.png' %}" ></a>
        <h2 class="titulo">Carrito</h2>
    </div>
    <form method="POST" id="formulario">
        {% csrf_token %}
        <div id="caja_productos">
            {% for producto in productos  %}
                <div id="producto_{{ producto.id }}" class="carrito_producto">
                    <!-- Usar de Variable de Sesión -->
                    <div class="carrito_prod_top">
                        <img class="carrito_prod_img" src="/media/{{ producto.imagen.imagen }}">
                        <div class="carrito_prod_infobox">
                            <div class="carrito_prod_info">
                                <p id="nombre_{{ producto.id }}" class="carrito_prod_nombre">{{ producto.nombre }}</p>
                                <p id="precio_{{ producto.id }}" class="carrito_prod_precio">CLP$ {{ producto.precio }}</p>
                            </div>
                            <div class="carrito_prod_cantidad">
                                <img id="restar_{{ producto.id }}" class="carrito_prod_restar" src="{% static 'BuyBeeApp/assets/images/Restar.png' %}">
                                <div id="cantidad_{{ producto.id }}" class="carrito_prod_cantidad_nro">{{ producto.cantidad }}</div>
                                <img id="sumar_{{ producto.id }}1" class="carrito_prod_añadir" src="{% static 'BuyBeeApp/assets/images/Añadir.png' %}">
                            </div>
                        </div>
                    </div>
                    <div class="carrito_prod_footer">
                        El costo de envío es de CLP$ 4.000
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="codigo">
          <input type="text" class="form-control" id="codigo_descuento_form" placeholder="Codigo de descuento" name="codigodescuento">
        </div>
        <div class="total_producto">
            <a href="{% url 'envio' %}" id="confirmar" type="submit" class="btn btn-primary">CLP$ 9000</a>
        </div>
    </form>
    <!-- Script -->
    <script>
        $(".carrito_prod_restar").click(function() {
            id = parseInt($(this).attr("id").replace("restar_", ""));
            cantidad = parseInt(document.getElementById("cantidad_" + id).textContent);
            if (cantidad > 0) {
                document.getElementById("cantidad_" + id).textContent = cantidad - 1;
                precio = document.getElementById("precio_" + id).textContent.replace("CLP$ ", "").replace(".", "")
                document.getElementById("confirmar").textContent = "CLP$ " + ((cantidad - 1) * parseInt(precio) + 4000);
            } else {
                document.getElementById("producto_" + id).style.display = "none";
                document.getElementById("confirmar").textContent = "CLP$ 0"
            }
        });
        $(".carrito_prod_añadir").click(function() {
            id = parseInt($(this).attr("id").replace("sumar_", ""));
            cantidad = parseInt(document.getElementById("cantidad_" + id).textContent);
            document.getElementById("cantidad_" + id).textContent = cantidad + 1;
            precio = document.getElementById("precio_" + id).textContent.replace("CLP$ ", "").replace(".", "")
            document.getElementById("confirmar").textContent = "CLP$ " + ((cantidad + 1) * parseInt(precio) + 4000);
        });
    </script>
    <!-- Fin del Script -->
</body>
</html>

