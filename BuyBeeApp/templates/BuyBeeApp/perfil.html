{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'BuyBeeApp/css/perfil.css' %}">
    <title>Perfil</title>
    <script src="{% static 'BuyBeeApp/js/jquery.js' %}"></script>
    <script src="{% static 'BuyBeeApp/js/perfil.js' %}"></script>
</head>

<body>
<!-- Modals -->
    <div id="modal">
        <div id="cuerpo-modal">
            <div id="modal-top">
                <img id="salir-modal" src="{% static 'BuyBeeApp/assets/images/Exit.png' %}"></a>
                <h3>Editar perfil</h3>
            </div>
            <div id="modal-datos">
                <form method="POST">
                    {% csrf_token %}
                    <div class="input-modal">
                        <label for="nombres" class="form-label">Nombres</label>
                        <input id="nombres" name="nombres" class="form-control form-control-sm" placeholder="{{ usuario.nombres }}" type="text" value="{{ usuario.nombres }}">
                    </div>
                    <div class="input-modal">
                        <label for="apellidos" class="form-label">Apellidos</label>
                        <input id="apellidos" name="apellidos" class="form-control form-control-sm" placeholder="{{ usuario.apellidos }}" type="text" value="{{ usuario.apellidos }}">
                    </div>
                    <div class="input-modal">
                        <label for="email" class="form-label">Email</label>
                        <input id="email" name="email" class="form-control form-control-sm" placeholder="{{ usuario.email }}" type="email" value="{{ usuario.email }}">
                    </div>
                    <div class="input-modal">
                        <label for="numero" class="form-label">Número</label>
                        {% if usuario.numero != None %}
                            <input id="numero" name="numero" class="form-control form-control-sm" placeholder="{{ usuario.numero }}" type="number" value="{{ usuario.numero }}">
                        {% else %}
                            <input id="numero" name="numero" class="form-control form-control-sm" placeholder="940529144" type="number" value="0">
                        {% endif %}
                    </div>
                    <div id="modal-contraseña">
                        <label for="password1" class="form-label">Contraseña</label>
                        <input id="password1" name="password1" class="form-control form-control-sm" type="password">
                    </div>
                    <input type="submit" value="Confirmar" id="submit">
                </div>
            </form>
        </div>
        <script>
            $("#salir-modal").click(function() {
                document.getElementById("modal").style.display = "none";
            })
            $("#modal").click(function(e) {
                if (document.elementFromPoint(e.clientX, e.clientY).id == "modal") {
                    document.getElementById("modal").style.display = "none";
                }
            })
            $(document).keyup(function(e) {
                if (e.key === "Escape" && document.getElementById("modal").style.display != "") {
                    document.getElementById("modal").style.display = "none";
                }
           });
        </script>
    </div>
    <div id="mdl-ped">
        <div id="cuerpo-mdl-ped">
            <div id="mdl-ped-left">
                <img class="mdl-ped-close" src="{% static 'BuyBeeApp/assets/images/Exit.png' %}">
                <div id="mdl-ped-left-info">
                    <span id="mdl-ped-resumen">Resumen del Pedido</span>
                    <div id="mdl-ped-resumen-txt">
                        <span id="numeropedido" class="modal-pedido-span">Número del Pedido: {numeropedido}</span>
                        <span id="fechapedido" class="modal-pedido-span">Fecha del Pedido: {fechapedido}</span>
                        <span id="estadopedido" class="modal-pedido-span">Estado del Pedido: {estadopedido}</span>
                        <span id="totalpedido" class="modal-pedido-span">Total: ${totalpedido}</span>
                    </div>
                </div>
            </div>
            <div id="mdl-ped-right">
                <div id="mdl-ped-right-info">
                </div>
            </div>
        </div>
        <script>
            $(".mdl-ped-close").click(function() {
                document.getElementById("mdl-ped").style.display = "none";
            })
            $("#mdl-ped").click(function(e) {
                if (document.elementFromPoint(e.clientX, e.clientY).id == "mdl-ped") {
                    document.getElementById("mdl-ped").style.display = "none";
                }
            })
            $(document).keyup(function(e) {
                if (e.key === "Escape" && document.getElementById("mdl-ped").style.display != "") {
                    document.getElementById("mdl-ped").style.display = "none";
                }
           });
        </script>
    </div>
    <div id="mdl-prod">
        <div id="cuerpo-mdl-prod">
            <div id="mdl-prod-left">
                <img class="mdl-prod-close" src="{% static 'BuyBeeApp/assets/images/Exit.png' %}">
                <div id="mdl-prod-left-info">
                    <figure id="mdl-prod-figure">
                        <div id="mdl-prod-figure-data">
                            <img id="mdl-prod-figure-img" src="">
                            <figcaption id="mdl-prod-figure-title">{nombreproducto}</figcaption>
                        </div>
                        <div id="mdl-prod-figure-extra">
                            <figcaption id="mdl-prod-figure-precio" class="mdl-prod-figure-extradata"></figcaption>
                            <figcaption id="mdl-prod-figure-stock" class="mdl-prod-figure-extradata">Stock: {stock}</figcaption>
                            <figcaption id="mdl-prod-figure-fecha" class="mdl-prod-figure-extradata">Publicación: {publicacion}</figcaption>
                            <figcaption id="mdl-prod-figure-vistas" class="mdl-prod-figure-extradata">Vistas: {vistas}</figcaption>
                            <figcaption id="mdl-prod-figure-compras" class="mdl-prod-figure-extradata">Compras: {compras}</figcaption>
                        </div>
                        <div id="mdl-prod-boton">
                            <button id="mdl-prod-pagina">Página del Producto</button>
                            <button id="mdl-prod-editar">Editar Producto</button>
                        </div>
                    </figure>
                </div>
            </div>
            <div id="mdl-prod-right">
                <div id="mdl-prod-right-info">
                </div>
            </div>
        </div>
        <script>
            $(".mdl-prod-close").click(function() {
                //document.getElementById("mdl-prod").style.display = "none";
                salirModal('producto')
            })
            $("#mdl-prod").click(function(e) {
                if (document.elementFromPoint(e.clientX, e.clientY).id == "mdl-prod") {
                    //document.getElementById("mdl-prod").style.display = "none";
                    salirModal('producto')
                }
            })
            $(document).keyup(function(e) {
                if (e.key === "Escape" && document.getElementById("mdl-prod").style.display != "") {
                    //document.getElementById("mdl-prod").style.display = "none";
                    salirModal('producto')
                }
           });
        </script>
    </div>
<!-- Fin Modals -->
    <div id="personal-info">
        <h1>Perfil</h1>
        <div id="foto">
            {% if usuario.foto_perfil == '' %}
                <div id="sinFotoDePerfil">
                    <form method="POST" enctype="multipart/form-data" id="fotoPerfilForm">
                        {% csrf_token %}
                        <!-- onchange="cambiarFoto()" -->
                        <input accept=".png,.jpg" onchange="document.getElementById('fotoPerfilForm').submit()" class="form-control form-control-sm" name="profilePicture" id="profilePicture" type="file">
                        <label for="profilePicture" class="fileFormLabel">
                            <img id="agregarFotoPerfil" src="{% static 'BuyBeeApp/assets/images/AgregarFoto.png' %}">
                        </label>
                    </form>
                </div>
            {% else %}
                <div id="sinFotoDePerfil" style="display: none">
                    <form method="POST" enctype="multipart/form-data" id="fotoPerfilForm">
                        {% csrf_token %}
                        <!-- onchange="cambiarFoto()" -->
                        <input accept=".png,.jpg" onchange="document.getElementById('fotoPerfilForm').submit()" class="form-control form-control-sm" name="profilePicture" id="profilePicture" type="file">
                        <label for="profilePicture" class="fileFormLabel">
                            <img id="agregarFotoPerfil" src="{% static 'BuyBeeApp/assets/images/AgregarFoto.png' %}">
                        </label>
                    </form>
                </div>
                <div id="conFotoDePerfil">
                    <img id="fotoDePerfil" src="{{ usuario.foto_perfil.url }}">
                    <img id="editarFotoPerfil" src="{% static 'BuyBeeApp/assets/images/Editar.png' %}">
                </div>
            {% endif %}
            <script>
                // Cambio la "opacity" (no se como se dice en español) via JQuery para el efecto bonito
                $("#editarFotoPerfil").hover(function () {
                    if ($(window).width() >= 950) {
                        $("#fotoDePerfil").css("opacity", 0.2);
                    }
                }, function () {
                    if ($(window).width() >= 950) {
                        $("#fotoDePerfil").css("opacity", 1);
                    }
                });
                /*
                 Aquí, utilizo el evento "click" de JQuery y "obligo" via JavaScript a que el
                cliente haga click en el input de imagen anterior, sin necesidad de que se muestre, con
                la función "click()"
                */
                $("#editarFotoPerfil").click(function (){
                    $("#profilePicture").click()
                });
            </script>
        </div>
        <div id="informacion-usuario">
            <div id="nombres-info">
                <h2 id="nombreapellido">{{ nombrecompleto }}</h2>
                <img id="editar-informacion" src="{% static 'BuyBeeApp/assets/images/Editar.png' %}">
            </div>
            <div id="decoradores">
                {% if usuario.suscrito %}
                    <div id="suscripcion" class="decorador" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ver suscripción">
                        <img src="{% static 'BuyBeeApp/assets/images/suscripcion.png' %}"> <span>Suscrito</span>
                    </div>
                {% endif %}
                {% if user.is_staff %}
                    <div id="staff" class="decorador" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ver panel administrativo">
                        <img src="{% static 'BuyBeeApp/assets/images/staff.png' %}"> <span>Administrador</span>
                    </div>
                {% endif %}
            </div>
            <script>
                if ($(window).width() >= 950) {
                    $("#nombres-info").hover(function() {
                        document.getElementById("editar-informacion").style.display = "flex";
                    }, function () {
                        document.getElementById("editar-informacion").style.display = "none";
                    });
                }
                $("#editar-informacion").click( function() {
                    document.getElementById("modal").style.display = "flex";
                })
            </script>
        </div>
        <a class="boton-blanco" href="{% url 'home' %}">
            <img src="{% static 'BuyBeeApp/assets/images/Home.png' %}">
            Inicio
        </a>
        <a class="boton-blanco" href="{% url 'ayuda' %}">
            <img src="{% static 'BuyBeeApp/assets/images/Ayuda.png' %}">
            Ayuda
        </a>
        {% if user.is_staff %}
            <a class="boton-blanco" href="{% url 'ayuda' %}">
                <img src="{% static 'BuyBeeApp/assets/images/Administracion.png' %}">
                Administración
            </a>
        {% endif %}
        <a class="cerrar" href="{% url 'logout' %}">
            <img src="{% static 'BuyBeeApp/assets/images/Logout.png' %}">
            Cerrar sesion
        </a>
    </div>
    <div id="extra-info">
        <div id="selectores">
            <h2 onclick="cambiarInfo('historial-compras')" class="historial-compras opcion activa">Historial Compras</h2>
            <h2 onclick="cambiarInfo('envios')" class="envios opcion">Envios</h2>
            <h2 onclick="cambiarInfo('productos-venta')" class="productos-venta opcion">Productos en Venta</h2>
        </div>
        <div id="contenido">
            {% if pedidos|length > 0 %}
                <div class="contenido-info" id="historial-compras">
                    {% for pedido in pedidos %}
                        <div id="pedido-{{ pedido.id }}" class="producto-data pedido">
                            <img src="media/{{ pedido.imagen }}">
                            <div class="producto-data-info">
                                <span class="producto-nombre">Pedido N°{{ pedido.id }}</span>
                                <span>{{ pedido.fecha }}</span>
                                <span>Productos: {{ pedido.cantidad_productos }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="sin-contenido-info" id="historial-compras">
                    <div id="no-data-found">
                        <img src="{% static 'BuyBeeApp/assets/images/Error.png' %}">
                        <span>No se han encontrado registros de Compras</span>
                    </div>
                </div>
            {% endif %}
            {% if envios|length > 0 %}
                <div class="contenido-info" id="envios" style="display: none;">
                    {% for envio in envios %}
                        <div class="envio-data">
                            <img src="media/{{ envio.imagen_producto }}">
                            <div class="producto-data-info">
                                <span class="producto-nombre">Envio N°{{ envio.id }}</span>
                                <span class="estado-envio estado-{{ envio.id }}">{{ envio.estado_nombre }}</span>
                                <span>Enviado por {{ envio.emisor_nombre }}</span>
                                <span class="envio-fecha-emision">El {{ envio.fecha_emision }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="sin-contenido-info" id="envios" style="display: none;">
                    <div id="no-data-found">
                        <img src="{% static 'BuyBeeApp/assets/images/Error.png' %}">
                        <span>No se han encontrado registros de Envios</span>
                    </div>
                </div>
            {% endif %}
            {% if productos|length > 0 %}
                <div class="contenido-info" id="productos-venta" style="display: none;">
                    {% for producto in productos %}
                        <!-- onclick="window.open('producto/{{ producto.id }}', '_self')" -->
                        <div class="producto-data producto-venta" name="{{ producto.id }}">
                            <img src="media/{{ producto.imagen.imagen }}">
                            <div class="producto-data-info">
                                <span class="producto-nombre">{{ producto.nombre }}</span>
                                <span>{{ producto.stock }} Disponible(s)</span>

                                <span>CLP$ {{ producto.precio }}</span>
                            </div>
                        </div>
                {% endfor %}
            {% else %}
                <div class="sin-contenido-info" id="productos-venta" style="display: none;">
                    <div id="no-data-found">
                        <img src="{% static 'BuyBeeApp/assets/images/Error.png' %}">
                        <span>No se han encontrado registros de Productos en Venta</span>
                    </div>
                </div>
            {% endif %}
            </div>
        </div>
        <script>
            $(".pedido").click(function() {
                displayModal('pedido', $(this))
            })
            $(".producto-venta").click(function() {
                displayModal('producto', $(this))
            })
        </script>
    </div>
</body>

</html>